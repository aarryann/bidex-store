<!DOCTYPE etl SYSTEM "http://scriptella.javaforge.com/dtd/etl.dtd">
<etl>
    <description>Imports data from FPDS exports into database</description>
    <properties>
      <include href="etl.properties"/> <!--Load from external properties file-->
    </properties>
    <!-- Connection declarations -->
    <connection id="in" driver="csv" url="../in/$FPDSIn" />
    <connection id="out" driver="$driver" url="$url" user="$user" password="$password" classpath="$classpath"/>
    <query connection-id="out">
      select uuid_generate_v4() as generatedId
      <script connection-id="out">
        INSERT INTO "Staging_Summary"( "id", "reportDate", "reportName", "loadStatus", "updatedOn")
        VALUES ( '${generatedId}', '${etl.date.today('yyyy-MM-dd HH:mm:ss.SSS')}', '$FPDSIn', 'Started', '${etl.date.today('yyyy-MM-dd HH:mm:ss.SSS')}' );
      </script>
      <query connection-id="in">
        <script connection-id="out">
          INSERT INTO public."FPDStaging_AwardDetails"(
            "Staging_SummaryId", "PIID", "ReferencedIDVPIID", "IDVProgramAcronym", "ReqDescription", "ContractingAgencyID", "ContractingAgencyName", "ContractingOfficeID", "ContractingOfficeName", "CountryAwardIssued", "FundingAgencyID", "FundingAgencyName", "FundingDepartmentName", "FundingOfficeID", "FundingOfficeName", "IsFundedForeign", "InherentlyGovFunction", "InherentlyGovDescription", "IDVDepartmentID", "IDVDepartmentName", "ReferencedIDVAgencyID", "ProgramAcronym", "SolicitationID", "FiscalYear", "DateSigned", "EffectiveDate", "CompletionDate", "EstUltimateCompletionDate", "LastDateToOrder", "TypeofContract", "TypeofSetAside", "NAICSCode", "NAICSDescription", "POPCity", "POPState", "ExtentCompeted", "AwardorIDVType", "SBIRSTTR", "VendorName", "DUNSNumber", "Zip", "WebsiteURL", "EmailAddress", "NumberofOffersReceived", "ModificationNumber", "ReasonForMod", "TransactionNumber", "OTFAC", "PBC", "SolicitationProcedures", "CostPricingData", "A76ActionCode", "TypeofIDC", "PreAwardFBOSynopsis", "BaseAndAllOptionsValue", "TotalContractValue", "ActionObligation", "Actions")
            VALUES ('${generatedId}', ?1, ?2, ?3, ?4, ?5, ?6, ?7, ?8, ?9, ?10, ?11, ?12, ?13, ?14, ?15, ?16, ?17, ?18, ?19, ?20, ?21, ?22, ?23, ?24, ?25, ?26, ?27, ?28, ?29, ?30, ?31, ?32, ?33, ?34, ?35, ?36, ?37, ?38, ?39, ?40, ?41, ?42, ?43, ?44, ?45, ?46, ?47, ?48, ?49, ?50, ?51, ?52, ?53, ?54, ?55, ?56, ?57 );
        </script>
      </query>    
    </query>
</etl>
